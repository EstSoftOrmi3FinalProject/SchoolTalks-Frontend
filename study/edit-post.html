<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>SchoolTalks</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.svg" />
    <!-- Place favicon.ico in the root directory -->

    <!-- Web Font -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/LineIcons.2.0.css" />
    <link rel="stylesheet" href="/assets/css/animate.css" />
    <link rel="stylesheet" href="/assets/css/tiny-slider.css" />
    <link rel="stylesheet" href="/assets/css/glightbox.min.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <style>
/* 수정 폼 컨테이너 스타일 */
#editPostForm {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* 폼 타이틀 스타일 */
#editPostForm label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

/* 입력 필드 스타일 */
#editPostForm input[type="text"],
#editPostForm textarea,
#editPostForm input[type="file"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 10px;
}

/* 텍스트 에어리어(내용 입력 부분) 스타일 */
#editPostForm textarea {
    height: 200px; /* 원하는 높이로 조정하세요 */
    resize: vertical; /* 사용자가 수직으로 리사이즈할 수 있도록 합니다 */
}

/* 버튼 스타일 */
#editPostForm button[type="submit"] {
    background-color: #195c2a;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s ease;
}

#editPostForm button[type="submit"]:hover {
    background-color: #0056b3; /* hover 시 배경색 변경 */
}

    </style>
</head>

<body>
    <header data-include-file="/header.html" class="header navbar-area includeJs"></header>

    <div class="preloader">
        <div class="preloader-inner">
            <div class="preloader-icon">
                <span></span>
                <span></span>
            </div>
        </div>
    </div>


    <!-- End Header Area -->
    <section class="hero-area">
      
        <br>
        <br>
        <form id="editPostForm" enctype="multipart/form-data">
            <h2 style="text-align: center;">✨ 게시글 수정 </h2>

            <label for="postTitle">제목</label>
            <input type="text" id="postTitle" name="postTitle" required>
            
            <label for="postCaption">내용</label>
            <textarea id="postCaption" name="postCaption" required></textarea>
            
            <label for="postImage">이미지 URL</label>
            <input type="file" id="postImage" name="postImage">
            
            <label for="postAttachment">첨부파일 URL</label>
            <input type="file" id="postAttachment" name="postAttachment">
            
            <button type="submit">수정 완료</button>
        </form>
    
        
    </section>
    <!--/ End Hero Area -->

    <!-- Start About Us Area -->
    <section class="hero-area" style="height:10vh;">
      
    </section>
    <!-- /End About Us Area -->



    <!-- Start Footer Area -->
    <footer class="footer">
        <!-- Start Middle Top -->

        <!--/ End Footer Middle -->
        <!-- Start Footer Bottom -->
        <div class="footer-bottom">
            <div class="container">
                <div class="inner">
                    <div class="row">
                        <div class="col-12">
                            <div class="left">
                                <p>Designed and Developed by<a href="https://graygrids.com/" rel="nofollow"
                                        target="_blank">GrayGrids</a></p>
                                        <p>- School Talks Project -</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Footer Middle -->
    </footer>
    <!--/ End Footer Area -->

    <!-- ========================= scroll-top ========================= -->
    <a href="#" class="scroll-top btn-hover">
        <i class="lni lni-chevron-up"></i>
    </a>

    <!-- ========================= JS here ========================= -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/count-up.min.js"></script>
    <script src="/assets/js/wow.min.js"></script>
    <script src="/assets/js/tiny-slider.js"></script>
    <script src="/assets/js/glightbox.min.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/logout.js"></script>
    <script src="/assets/js/study/study-create-post.js"></script>
    <script src="/assets/js/include.js"></script>


    <script type="text/javascript">
        //========= Hero Slider 
        tns({
            container: '.hero-slider',
            items: 1,
            slideBy: 'page',
            autoplay: false,
            mouseDrag: true,
            gutter: 0,
            nav: true,
            controls: false,
            controlsText: ['<i class="lni lni-arrow-left"></i>', '<i class="lni lni-arrow-right"></i>'],
        });
        //====== Clients Logo Slider
        tns({
            container: '.client-logo-carousel',
            slideBy: 'page',
            autoplay: true,
            autoplayButtonOutput: false,
            mouseDrag: true,
            gutter: 15,
            nav: false,
            controls: false,
            responsive: {
                0: {
                    items: 1,
                },
                540: {
                    items: 3,
                },
                768: {
                    items: 4,
                },
                992: {
                    items: 4,
                },
                1170: {
                    items: 6,
                }
            }
        });

    </script>
     <!-- <script>
        document.addEventListener('DOMContentLoaded', function() {
      const accessToken = localStorage.getItem('access_token');
      
      // URL에서 pk(게시물의 Primary Key)를 추출합니다.
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get('postId');
      
      // pk가 유효한 경우, 해당 게시물 정보를 가져옵니다.
      if (postId) {
          fetch(`http://127.0.0.1:8000/study/${postId}/`, {
              method: 'GET',
              headers: {
                  'Authorization': 'Bearer ' + accessToken,
              },
          })
          .then(response => {
              if (!response.ok) {
                  throw new Error('게시물 정보를 가져오는 중 오류가 발생했습니다.');
              }
              return response.json();
          })
          .then(data => {
              // 게시물 정보를 사용하여 폼 필드를 채웁니다.
              document.getElementById('postTitle').value = data.title;
              document.getElementById('postCaption').value = data.caption;
              document.getElementById('postImage').files[0] = data.image;
              document.getElementById('postAttachment').files[0] = data.attachment;
          })
          .catch(error => {
              console.error('Error:', error);
              alert('게시물 정보를 가져오는 중 오류가 발생했습니다.');
          });
      }
      
      // 게시물 수정 폼 제출 이벤트 리스너
      document.getElementById('editPostForm').addEventListener('submit', function(event) {
          event.preventDefault();
      
          // 수정 폼에서 변경된 정보를 가져옵니다.
          const editedTitle = document.getElementById('postTitle').value;
          const editedCaption = document.getElementById('postCaption').value;
          const image = document.getElementById('postImage').files[0];
          const attachment = document.getElementById('postAttachment').files[0];
  
      
          // 서버에 수정된 게시물 정보를 전송하는 로직을 추가합니다.
          // PUT 또는 PATCH 요청을 사용하여 게시물을 업데이트할 수 있습니다.
      const formData = new FormData();
      formData.append('title', editedTitle);
      formData.append('caption', editedCaption);
      formData.append('image', image);
      formData.append('attachment', attachment);
      if (imageInput.files.length > 0) {
                // 이미지 파일이 선택된 경우에만 FormData에 추가합니다.
                formData.append('image', imageInput.files[0]);
            }

            if (attachmentInput.files.length > 0) {
                // 첨부 파일이 선택된 경우에만 FormData에 추가합니다.
                formData.append('attachment', attachmentInput.files[0]);
            }

  
  
          fetch(`http://127.0.0.1:8000/study/${postId}/update/`, {
              method: 'PATCH', // 또는 'PATCH' 요청을 사용할 수 있습니다.
              headers: {
                  'Authorization': 'Bearer ' + accessToken,
              },
              body: formData
          })
          .then(response => {
          if (!response.ok) {
              throw new Error('게시물 수정 중 오류가 발생했습니다.');
          }
          return response.json();
      })
      .then(data => {
          console.log('게시물이 성공적으로 수정되었습니다:', data);
          // 수정 후 해당 게시물로 이동
          window.location.href = `post.html?postId=${postId}`;
      })
      .catch(error => {
          console.error('Error:', error);
          alert('게시물 수정 실패');
      });
  });
  });
      </script> -->

      <script>
        document.addEventListener('DOMContentLoaded', function() {
            const accessToken = localStorage.getItem('access_token');
    
            // URL에서 pk(게시물의 Primary Key)를 추출합니다.
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('postId');
    
            // pk가 유효한 경우, 해당 게시물 정보를 가져옵니다.
            if (postId) {
                fetch(`http://127.0.0.1:8000/study/${postId}/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                    },
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('게시물 정보를 가져오는 중 오류가 발생했습니다.');
                    }
                    return response.json();
                })
                .then(data => {
                    // 게시물 정보를 사용하여 폼 필드를 채웁니다.
                    document.getElementById('postTitle').value = data.title;
                    document.getElementById('postCaption').value = data.caption;
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('게시물 정보를 가져오는 중 오류가 발생했습니다.');
                });
            }
    
            // 게시물 수정 폼 제출 이벤트 리스너
            document.getElementById('editPostForm').addEventListener('submit', function(event) {
                event.preventDefault();
    
                // 수정 폼에서 변경된 정보를 가져옵니다.
                const editedTitle = document.getElementById('postTitle').value;
                const editedCaption = document.getElementById('postCaption').value;
    
                // 서버에 전송할 JSON 데이터를 생성합니다.
                const jsonData = {
                    "title": editedTitle,
                    "caption": editedCaption
                };
    
                // 이미지와 첨부 파일 input 요소 가져오기
                const imageInput = document.getElementById('postImage');
                const attachmentInput = document.getElementById('postAttachment');
    
                // 이미지와 첨부 파일이 선택된 경우 FormData에 추가합니다.
                if (imageInput.files.length > 0) {
                    jsonData["image"] = imageInput.files[0];
                }
    
                if (attachmentInput.files.length > 0) {
                    jsonData["attachment"] = attachmentInput.files[0];
                }
    
                // 서버에 수정된 게시물 정보를 전송합니다.
                fetch(`http://127.0.0.1:8000/study/${postId}/update/`, {
                    method: 'PATCH', // 'PATCH' 요청을 사용하여 일부 필드만 수정합니다.
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        // 서버로 JSON 데이터를 전송한다고 명시합니다.
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData) // JSON 데이터를 문자열로 변환하여 전송합니다.
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('게시물 수정 중 오류가 발생했습니다.');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('게시물이 성공적으로 수정되었습니다:', data);
                    // 수정 후 해당 게시물로 이동
                    window.location.href = `post.html?postId=${postId}`;
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('게시물 수정 실패');
                });
            });
        });
    </script>
    
</body>

</html>
